---
description: é¡¹ç›®ä»£ç å¼€å‘æ€»ä½“è§„èŒƒ - é€‚ç”¨äºæ‰€æœ‰ä»£ç æ–‡ä»¶
globs:
alwaysApply: true
---

# é¡¹ç›®ä»£ç å¼€å‘è§„èŒƒ

## æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: Next.js 16 (App Router) + React 19 + TypeScript
- **æ•°æ®åº“**: **Drizzle ORM** + PostgreSQLï¼ˆâŒ ç¦æ­¢ä½¿ç”¨ Prismaï¼‰
- **çŠ¶æ€ç®¡ç†**: TanStack React Query (æœåŠ¡ç«¯) + Zustand (å®¢æˆ·ç«¯) + nuqs (URL)
- **UI**: Radix UI + Tailwind CSS + shadcn/ui
- **è¡¨å•**: React Hook Form + Zod
- **æç¤º**: sonner (toast) + nextjs-toploader (åŠ è½½æ¡)

## ğŸ”´ æ ¸å¿ƒåŸåˆ™

1. **æ•°æ®åº“è®¿é—®**: åªä½¿ç”¨ Drizzle ORMï¼Œç¦æ­¢ä½¿ç”¨ Prisma
2. **é¡µé¢æ•°æ®**: ä½¿ç”¨ Hooks + Server Actionsï¼Œç¦æ­¢ä½¿ç”¨ fetch('/api/...')
3. **API è·¯ç”±**: ä»…ç”¨äº SSE æµæ¨é€ï¼Œå…¶ä»–æ“ä½œä½¿ç”¨ Server Actions

## é¡¹ç›®ç»“æ„

```
app/(admin)/             # ç®¡ç†åå°é¡µé¢
app/(public)/            # å…¬å¼€é¡µé¢
app/api/                 # API è·¯ç”±ï¼ˆä»…ç”¨äº SSE æµï¼‰
components/              # å…±äº«ç»„ä»¶
  ui/                    # shadcn/ui åŸºç¡€ç»„ä»¶
  shared/                # ä¸šåŠ¡å…±äº«ç»„ä»¶
hooks/                   # è‡ªå®šä¹‰ Hooks (use-{domain}.ts)
server/
  db/                    # Drizzle æ•°æ®åº“
    index.ts             # æ•°æ®åº“è¿æ¥
    schema/              # Schema å®šä¹‰
  actions/               # Server Actions ({entity}Action.ts)
types/                   # ç±»å‹å®šä¹‰ ({domain}-types.ts)
lib/                     # å·¥å…·å‡½æ•°
```

## å¯¼å…¥é¡ºåºï¼ˆå¼ºåˆ¶ï¼‰

```tsx
// 1. React
import * as React from "react";
import { useState, useEffect, useMemo, useCallback } from "react";

// 2. Next.js
import { useRouter } from "next/navigation";

// 3. Third-party
import { toast } from "sonner";
import { useTopLoader } from "nextjs-toploader";
import { useMutation, useQuery } from "@tanstack/react-query";

// 4. UI Components
import { Button } from "@/components/ui/button";

// 5. Business Components
import PageContainer from "@/components/page-container";

// 6. Hooks
import { useEntities } from "@/hooks/use-entities";

// 7. Server Actions
import { createEntity } from "@/server/actions/entityAction";

// 8. Types
import type { Entity } from "@/types/entity-types";
```

## ç»„ä»¶ç»“æ„ï¼ˆå¼ºåˆ¶ï¼‰

```tsx
export default function Component() {
  // 1. Hooks
  const router = useRouter();
  const { start, done } = useTopLoader();

  // 2. State
  const [value, setValue] = useState("");

  // 3. Memoized values
  const filtered = useMemo(() => data.filter(...), [data]);

  // 4. Callbacks
  const handleSubmit = useCallback(async () => {
    start();
    try { ... } finally { done(); }
  }, [/* ä¸åŒ…å« start/done */]);

  // 5. Effects
  useEffect(() => { ... }, []);

  // 6. Render
  return <div>...</div>;
}
```

## æ ¸å¿ƒè§„åˆ™

### è·¯å¾„åˆ«å
- âœ… ä½¿ç”¨ `@/` è·¯å¾„åˆ«å
- âŒ ç¦æ­¢ä½¿ç”¨ç›¸å¯¹è·¯å¾„ `../../../`

### åŠ è½½çŠ¶æ€
- âœ… ä½¿ç”¨ `useTopLoader` çš„ `start()`/`done()`
- âš ï¸ **ç¦æ­¢** å°† `start`/`done` æ·»åŠ åˆ° `useCallback` ä¾èµ–ï¼ˆä¼šå¯¼è‡´æ­»å¾ªç¯ï¼‰

### Toast æç¤º
- âœ… ä½¿ç”¨ `sonner` çš„ `toast.success()`/`toast.error()`
- âœ… æ ¹æ® `res.success` æ˜¾ç¤ºä¸åŒæç¤º

### Mutation çŠ¶æ€
- âœ… ä½¿ç”¨ `mutation.isPending`
- âŒ ç¦æ­¢ä½¿ç”¨ `isLoading`

### æ€§èƒ½ä¼˜åŒ–
- âœ… è¡¨æ ¼åˆ—å®šä¹‰ä½¿ç”¨ `useMemo`
- âœ… å›è°ƒå‡½æ•°ä½¿ç”¨ `useCallback`
- âœ… å¤æ‚è®¡ç®—ä½¿ç”¨ `useMemo`

## ç¦æ­¢äº‹é¡¹

- âŒ ä½¿ç”¨ Prismaï¼ˆé¡¹ç›®ä½¿ç”¨ Drizzle ORMï¼‰
- âŒ ä½¿ç”¨ fetch('/api/...') è·å–/æäº¤æ•°æ®ï¼ˆä½¿ç”¨ Hooks + Server Actionsï¼‰
- âŒ åœ¨é¡µé¢ä¸­ç›´æ¥è°ƒç”¨æ•°æ®åº“ï¼ˆé€šè¿‡ Server Actionsï¼‰
- âŒ ä½¿ç”¨ window.confirmï¼ˆä½¿ç”¨ DeleteConfirm ç»„ä»¶ï¼‰
