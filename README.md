# Murphy äº’åŠ¨å·¥å…·é›†

ä¸€ä¸ªé¢å‘å…¨ç¤¾ä¼šçš„å¤šåœºæ™¯äº’åŠ¨å·¥å…·å¹³å°ï¼Œæ”¯æŒç­¾åˆ°ã€æŠ•ç¥¨ã€æŠ½å¥–ã€è¡¨å•ç­‰åŠŸèƒ½ã€‚

## æŠ€æœ¯æ ˆ

- âš›ï¸ **Framework** - Next.js 16 (App Router)
- ğŸ“ **Language** - TypeScript
- ğŸ¨ **Styling** - Tailwind CSS v4
- ğŸ§© **Components** - Shadcn-ui
- âœ… **Schema Validations** - Zod
- ğŸ—‚ï¸ **State Management** - Zustand

## åŠŸèƒ½æ¨¡å—

### ğŸ“ ç­¾åˆ° (å·²å®Œæˆ)
- ç‹¬ç«‹åˆ›å»ºç­¾åˆ°æ´»åŠ¨ï¼Œè·å¾—å”¯ä¸€çŸ­ç 
- å¤§å±å±•ç¤ºï¼ŒäºŒç»´ç ä½ç½®å¯é…ç½®ï¼ˆ9å®«æ ¼ä»»æ„ä½ç½®ï¼‰
- æ‰‹æœºæ‰«ç ç­¾åˆ°ï¼Œæ”¯æŒæ”¶é›†å§“åã€éƒ¨é—¨ç­‰ä¿¡æ¯
- ç­¾åˆ°åå¯é…ç½®ï¼šæ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯ã€è·³è½¬æŒ‡å®šURLã€æ— æ“ä½œ
- å®æ—¶å¼¹å¹•æ¬¢è¿ã€ç»Ÿè®¡å±•ç¤º
- 3ä½éªŒè¯ç é˜²æ­¢æ¶æ„ä¿®æ”¹

### ğŸ“Š æŠ•ç¥¨ (å·²å®Œæˆ)
- å®šåˆ¶åŒ–æŠ•ç¥¨ä¸»é¢˜
- å•é€‰/å¤šé€‰æ”¯æŒ
- å®æ—¶ç»“æœå±•ç¤ºï¼ˆSSEæ¨é€ï¼‰
- å¤šç§å›¾è¡¨å¯è§†åŒ–ï¼ˆé¥¼å›¾ã€æŸ±çŠ¶å›¾ã€è¿›åº¦æ¡ã€å¯¹å†³æ¨¡å¼ï¼‰
- å…è®¸ä¿®æ”¹æŠ•ç¥¨ã€åŒ¿åæŠ•ç¥¨ç­‰è§„åˆ™é…ç½®
- å¤§å±äºŒç»´ç ä½ç½®å¯é…ç½®

### ğŸ æŠ½å¥– (å·²å®Œæˆ)
- å¤šç§æŠ½å¥–æ¨¡å¼ï¼ˆè½¬ç›˜ã€è€è™æœºï¼‰
- ç²¾å½©åŠ¨ç”»æ•ˆæœ
- è‡ªå®šä¹‰å¥–å“å’Œæ¦‚ç‡
- æ¯äººæŠ½å¥–æ¬¡æ•°é™åˆ¶
- å®æ—¶ä¸­å¥–æ¨é€å’Œåå•å±•ç¤º
- å¤§å±ä¸­å¥–å¼¹å¹•æ•ˆæœ

### ğŸ æŠ½å¥–ç‰¹æ€§ (åŸå¼€å‘ä¸­)
- å¤šç§æŠ½å¥–æ¨¡å¼ï¼ˆè½¬ç›˜ã€æ»šåŠ¨ã€çº¢åŒ…é›¨ç­‰ï¼‰
- å¥–å“è®¾ç½®ä¸æ¦‚ç‡é…ç½®
- ç²¾å½©çš„æŠ½å¥–åŠ¨ç”»

### ğŸ“‹ è¡¨å• (å·²å®Œæˆ)
- å®šåˆ¶åŒ–è¡¨å•å­—æ®µï¼ˆæ–‡æœ¬ã€æ•°å­—ã€æ‰‹æœºå·ã€é‚®ç®±ã€å•é€‰ã€å¤šé€‰ã€ä¸‹æ‹‰ã€æ—¥æœŸã€æ—¶é—´ã€è¯„åˆ†ç­‰ï¼‰
- æäº¤å‰é¢„è§ˆç¡®è®¤
- æäº¤åæˆåŠŸåé¦ˆã€è·³è½¬æ”¯æŒ
- æ¯äººé™æäº¤ä¸€æ¬¡ã€éœ€è¦æ‰‹æœºå·ç­‰è§„åˆ™
- SSE å®æ—¶æ¨é€æ–°æäº¤
- CSV æ•°æ®å¯¼å‡º

## é¡µé¢ç»“æ„

### å…¬å¼€é¡µé¢ï¼ˆå‚ä¸è€…ï¼‰
| åŠŸèƒ½ | æ‰‹æœºç«¯å…¥å£ | å¤§å±å±•ç¤º | çŠ¶æ€ |
|------|-----------|----------|------|
| ç­¾åˆ° | `/c/{code}` | `/c/{code}/display` | âœ… å·²å®Œæˆ |
| æŠ•ç¥¨ | `/v/{code}` | `/v/{code}/display` | âœ… å·²å®Œæˆ |
| è¡¨å• | `/f/{code}` | `/f/{code}/display` | âœ… å·²å®Œæˆ |
| æŠ½å¥– | `/l/{code}` | `/l/{code}/display` | âœ… å·²å®Œæˆ |

### ç®¡ç†åå°
| é¡µé¢ | åœ°å€ | è¯´æ˜ |
|------|------|------|
| é¦–é¡µ | `/` | äº§å“ä»‹ç»é¡µ |
| æ§åˆ¶å° | `/dashboard` | ç®¡ç†åå°é¦–é¡µ |
| ç­¾åˆ°ç®¡ç† | `/checkins` | ç­¾åˆ°åˆ—è¡¨ |
| åˆ›å»ºç­¾åˆ° | `/checkins/new` | åˆ›å»ºæ–°ç­¾åˆ° |
| ç­¾åˆ°è¯¦æƒ… | `/checkins/{id}` | æŸ¥çœ‹ç­¾åˆ°æ•°æ® |
| æŠ•ç¥¨ç®¡ç† | `/votes` | æŠ•ç¥¨åˆ—è¡¨ |
| åˆ›å»ºæŠ•ç¥¨ | `/votes/new` | åˆ›å»ºæ–°æŠ•ç¥¨ |
| æŠ•ç¥¨è¯¦æƒ… | `/votes/{id}` | æŸ¥çœ‹æŠ•ç¥¨æ•°æ® |
| è¡¨å•ç®¡ç† | `/forms` | è¡¨å•åˆ—è¡¨ |
| åˆ›å»ºè¡¨å• | `/forms/new` | åˆ›å»ºæ–°è¡¨å• |
| è¡¨å•è¯¦æƒ… | `/forms/{id}` | æŸ¥çœ‹è¡¨å•æ•°æ® |
| æŠ½å¥–ç®¡ç† | `/lotteries` | æŠ½å¥–åˆ—è¡¨ |
| åˆ›å»ºæŠ½å¥– | `/lotteries/new` | åˆ›å»ºæ–°æŠ½å¥– |
| æŠ½å¥–è¯¦æƒ… | `/lotteries/{id}` | æŸ¥çœ‹æŠ½å¥–æ•°æ® |

## å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
pnpm install
```

### å¼€å‘æ¨¡å¼

```bash
pnpm dev
```

è®¿é—® http://localhost:3000

### ç”Ÿäº§æ„å»º

```bash
pnpm build
pnpm start
```

## ä½¿ç”¨æµç¨‹

### ç®¡ç†å‘˜æ“ä½œ

1. è®¿é—®æ§åˆ¶å° `/dashboard`
2. ç‚¹å‡»ã€Œåˆ›å»ºç­¾åˆ°ã€
3. é…ç½®ç­¾åˆ°æ ‡é¢˜ã€æ”¶é›†ä¿¡æ¯ã€ç­¾åˆ°åè¡Œä¸ºç­‰
4. åˆ›å»ºæˆåŠŸåè·å¾—ç­¾åˆ°çŸ­ç 
5. æ‰“å¼€å¤§å±å±•ç¤º `/c/{code}/display`
6. åˆ†äº«æ‰‹æœºç«¯é“¾æ¥æˆ–äºŒç»´ç ç»™å‚ä¸è€…

### å‚ä¸è€…æ“ä½œ

1. æ‰«æäºŒç»´ç æˆ–è®¿é—® `/c/{code}`
2. å¡«å†™æ‰‹æœºå·ã€å§“åç­‰ä¿¡æ¯
3. ç‚¹å‡»ã€Œç¡®è®¤ç­¾åˆ°ã€
4. ç­¾åˆ°æˆåŠŸï¼Œå¤§å±å®æ—¶æ˜¾ç¤ºæ¬¢è¿å¼¹å¹•

## å¤§å±äºŒç»´ç ä½ç½®

äºŒç»´ç å¯é…ç½®åœ¨å¤§å±çš„9ä¸ªä½ç½®ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å·¦ä¸Š     ä¸­ä¸Š     å³ä¸Š      â”‚
â”‚                             â”‚
â”‚  å·¦ä¸­     ä¸­å¿ƒ     å³ä¸­      â”‚
â”‚                             â”‚
â”‚  å·¦ä¸‹     ä¸­ä¸‹     å³ä¸‹      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ä¹Ÿå¯ä»¥é€‰æ‹©ã€Œéšè—ã€ï¼ŒäºŒç»´ç ä¸æ˜¾ç¤ºåœ¨å¤§å±ä¸Šã€‚

## é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ (admin)/              # ç®¡ç†åå°
â”‚   â”‚   â”œâ”€â”€ dashboard/        # æ§åˆ¶å°
â”‚   â”‚   â”œâ”€â”€ checkins/         # ç­¾åˆ°ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ new/          # åˆ›å»ºç­¾åˆ°
â”‚   â”‚   â”‚   â””â”€â”€ [id]/         # ç­¾åˆ°è¯¦æƒ…
â”‚   â”‚   â””â”€â”€ layout.tsx        # åå°å¸ƒå±€
â”‚   â”œâ”€â”€ (public)/             # å…¬å¼€é¡µé¢
â”‚   â”‚   â””â”€â”€ c/[code]/         # ç­¾åˆ°
â”‚   â”‚       â”œâ”€â”€ page.tsx      # æ‰‹æœºç«¯
â”‚   â”‚       â””â”€â”€ display/      # å¤§å±
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ checkins/         # ç­¾åˆ° API
â”‚   â”œâ”€â”€ page.tsx              # é¦–é¡µ
â”‚   â””â”€â”€ layout.tsx            # æ ¹å¸ƒå±€
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/                   # åŸºç¡€ç»„ä»¶
â”‚   â””â”€â”€ display/              # å¤§å±ç»„ä»¶
â”‚       â”œâ”€â”€ qr-code-widget.tsx
â”‚       â”œâ”€â”€ danmaku.tsx
â”‚       â”œâ”€â”€ stats-widget.tsx
â”‚       â”œâ”€â”€ vote-charts.tsx   # æŠ•ç¥¨å›¾è¡¨ç»„ä»¶
â”‚       â”œâ”€â”€ lottery-wheel.tsx # æŠ½å¥–è½¬ç›˜ç»„ä»¶
â”‚       â””â”€â”€ lottery-slot.tsx  # è€è™æœºç»„ä»¶
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ stores/               # æ•°æ®å­˜å‚¨
â”‚   â”‚   â”œâ”€â”€ checkin-store.ts
â”‚   â”‚   â”œâ”€â”€ vote-store.ts
â”‚   â”‚   â”œâ”€â”€ form-store.ts
â”‚   â”‚   â””â”€â”€ lottery-store.ts
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ code-generator.ts
â””â”€â”€ types/
    â”œâ”€â”€ common.ts             # é€šç”¨ç±»å‹
    â”œâ”€â”€ checkin.ts            # ç­¾åˆ°ç±»å‹
    â”œâ”€â”€ vote.ts               # æŠ•ç¥¨ç±»å‹
    â”œâ”€â”€ form.ts               # è¡¨å•ç±»å‹
    â””â”€â”€ lottery.ts            # æŠ½å¥–ç±»å‹
```

## API æ¥å£

### ç­¾åˆ°ç›¸å…³

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/api/checkins` | è·å–ç­¾åˆ°åˆ—è¡¨ |
| POST | `/api/checkins` | åˆ›å»ºç­¾åˆ° |
| GET | `/api/checkins/{id}` | è·å–ç­¾åˆ°è¯¦æƒ… |
| PATCH | `/api/checkins/{id}` | æ›´æ–°ç­¾åˆ° |
| DELETE | `/api/checkins/{id}` | åˆ é™¤ç­¾åˆ° |
| GET | `/api/checkins/{id}/qrcode` | è·å–äºŒç»´ç  |
| GET | `/api/checkins/{id}/records` | è·å–ç­¾åˆ°è®°å½• |
| POST | `/api/checkins/{id}/confirm` | æ‰§è¡Œç­¾åˆ° |
| GET | `/api/checkins/{id}/stream` | SSE å®æ—¶æ¨é€ |
| GET | `/api/checkins/code/{code}` | æ ¹æ®çŸ­ç è·å–ç­¾åˆ° |

### æŠ•ç¥¨ç›¸å…³

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/api/votes` | è·å–æŠ•ç¥¨åˆ—è¡¨ |
| POST | `/api/votes` | åˆ›å»ºæŠ•ç¥¨ |
| GET | `/api/votes/{id}` | è·å–æŠ•ç¥¨è¯¦æƒ… |
| PATCH | `/api/votes/{id}` | æ›´æ–°æŠ•ç¥¨ |
| DELETE | `/api/votes/{id}` | åˆ é™¤æŠ•ç¥¨ |
| POST | `/api/votes/{id}?action=reset` | é‡ç½®æŠ•ç¥¨ç»“æœ |
| GET | `/api/votes/{id}/qrcode` | è·å–äºŒç»´ç  |
| POST | `/api/votes/{id}/submit` | æäº¤æŠ•ç¥¨ |
| GET | `/api/votes/{id}/submit?phone=xxx` | æ£€æŸ¥æ˜¯å¦å·²æŠ•ç¥¨ |
| GET | `/api/votes/{id}/stream` | SSE å®æ—¶æ¨é€ |
| GET | `/api/votes/code/{code}` | æ ¹æ®çŸ­ç è·å–æŠ•ç¥¨ |

### è¡¨å•ç›¸å…³

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/api/forms` | è·å–è¡¨å•åˆ—è¡¨ |
| POST | `/api/forms` | åˆ›å»ºè¡¨å• |
| GET | `/api/forms/{id}` | è·å–è¡¨å•è¯¦æƒ… |
| PATCH | `/api/forms/{id}` | æ›´æ–°è¡¨å• |
| DELETE | `/api/forms/{id}` | åˆ é™¤è¡¨å• |
| GET | `/api/forms/{id}/qrcode` | è·å–äºŒç»´ç  |
| GET | `/api/forms/{id}/responses` | è·å–æäº¤åˆ—è¡¨ |
| GET | `/api/forms/{id}/responses?format=csv` | å¯¼å‡º CSV |
| POST | `/api/forms/{id}/submit` | æäº¤è¡¨å• |
| GET | `/api/forms/{id}/submit?phone=xxx` | æ£€æŸ¥æ˜¯å¦å·²æäº¤ |
| GET | `/api/forms/{id}/stream` | SSE å®æ—¶æ¨é€ |
| GET | `/api/forms/code/{code}` | æ ¹æ®çŸ­ç è·å–è¡¨å• |

### æŠ½å¥–ç›¸å…³

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/api/lotteries` | è·å–æŠ½å¥–åˆ—è¡¨ |
| POST | `/api/lotteries` | åˆ›å»ºæŠ½å¥– |
| GET | `/api/lotteries/{id}` | è·å–æŠ½å¥–è¯¦æƒ… |
| PATCH | `/api/lotteries/{id}` | æ›´æ–°æŠ½å¥– |
| DELETE | `/api/lotteries/{id}` | åˆ é™¤æŠ½å¥– |
| POST | `/api/lotteries/{id}?action=reset` | é‡ç½®æŠ½å¥– |
| GET | `/api/lotteries/{id}/qrcode` | è·å–äºŒç»´ç  |
| POST | `/api/lotteries/{id}/draw` | æ‰§è¡ŒæŠ½å¥– |
| GET | `/api/lotteries/{id}/draw?phone=xxx` | æ£€æŸ¥æŠ½å¥–æ¬¡æ•° |
| GET | `/api/lotteries/{id}/records` | è·å–ä¸­å¥–è®°å½• |
| GET | `/api/lotteries/{id}/stream` | SSE å®æ—¶æ¨é€ |
| GET | `/api/lotteries/code/{code}` | æ ¹æ®çŸ­ç è·å–æŠ½å¥– |

## ç¯å¢ƒå˜é‡

```env
# åº”ç”¨åŸºç¡€URLï¼ˆç”¨äºç”ŸæˆäºŒç»´ç é“¾æ¥ï¼‰
NEXT_PUBLIC_BASE_URL=http://localhost:3000
```

## ç”Ÿäº§ç¯å¢ƒæ³¨æ„äº‹é¡¹

1. **æ•°æ®å­˜å‚¨**: å½“å‰ä½¿ç”¨å†…å­˜å­˜å‚¨ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ Redis æˆ–æ•°æ®åº“
2. **åŸŸåé…ç½®**: éœ€è¦é…ç½®æ­£ç¡®çš„ `NEXT_PUBLIC_BASE_URL`
3. **HTTPS**: ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨ HTTPS
4. **è·¨åŸŸé…ç½®**: åœ¨ `next.config.ts` ä¸­é…ç½® `allowedDevOrigins`

## License

MIT
